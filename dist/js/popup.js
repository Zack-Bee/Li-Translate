if(!Li)var Li={};!function(){"use strict";var e=new Date,t=e.getUTCFullYear(),n=e.getUTCMonth(),i=e.getUTCDay();Li.notWords=["Li-setting",t+"."+n+"."+i],Li.today=t+"."+n+"."+i}(),Li.currentWord={},Li.savedWords=[],Li.savedQuery=[],Li.notePageInited=!1,Li.settingPageInited=!1,Li.inited=!1,Li.port=chrome.runtime.connect({name:"popup"}),Li.setting={},Li.isEmpty=function(e){"use strict";for(var t in e)return!1;return!0},Li.init=function(){"use strict";chrome.storage.sync.get("today",function(e){if(e.today!==Li.today){var t={};t.today=Li.today,chrome.storage.sync.set(t),chrome.storage.local.get("words",function(e){e.words;chrome.storage.sync.get("words",function(e){var t=e.words,n=n,i={};if(n){if(t&&length)for(var s=0,r=t.length;s<r;s++)n.concat(t[s]);i.words=n,i.words&&chrome.storage.local.set(i,function(){chrome.storage.sync.set({words:[]})})}})})}else chrome.storage.sync.get("words",function(e){e.words&&(Li.savedWords=e.words);for(var t=0,n=Li.savedWords.length;t<n;t++)Li.savedQuery[t]=Li.savedWords[t].word});Li.inited=!0})},Li.initNotePage=function(){"use strict";var e=document.getElementById("current"),t=document.getElementById("total");e.innerText=Li.savedWords.length>0?1:0,t.innerText=Li.savedWords.length,Li.notePageInited=!0,Li.savedWords[0]&&Li.showResult(Li.savedWords[0],document.getElementById("noteResult"))},Li.initSettingPage=function(){"use strict";chrome.storage.sync.get("setting",function(e){var t=document.getElementById("settingBtn");if(e.setting)Li.setting=e.setting;else{var n={};Li.setting={translateSelected:!0},n.setting=Li.setting,chrome.storage.sync.set(n)}Li.setting.translateSelected?t.classList.add("setting-btn-show"):t.classList.remove("setting-btn-show"),Li.settingPageInited=!0})},Li.listenChangePage=function(){"use strict";function e(e){e.classList.add("show")}function t(e){e.classList.remove("show")}var n=document.getElementById("toNote"),i=document.getElementById("toTranslate"),s=document.getElementById("toSetting"),r=(document.getElementById("translatePage"),document.getElementById("settingPage")),o=document.getElementById("notePage");n.addEventListener("click",function(){Li.initNotePage(),e(o),t(r)}),i.addEventListener("click",function(){t(r),t(o)}),s.addEventListener("click",function(){Li.settingPageInited||Li.initSettingPage(),e(r),t(o)})},Li.showResult=function(e,t,n){"use strict";t.innerHTML="";var i=document.createElement("div");i.className="translation-group",n&&document.getElementById("noteBtn").classList.add("saved"),e&&!Li.isEmpty(e)?(e.word&&(e.word.length>20?i.innerHTML+='<p class="search-item">'+e.word.slice(0,20)+"...</p>":i.innerHTML+='<p class="search-item">'+e.word+"</p>"),e.pronun&&(i.innerHTML+='<p class="translation">发音：'+e.pronun+"</p>"),e.means&&e.means.length>0?e.means.forEach(function(e){i.innerHTML+='<p class="translation">'+e+"</p>"}):i.innerHTML+='<p class="search-item">很抱歉，没有找到相关的翻译</p>'):i.innerHTML='<p class="search-item">请检查您的网络连接稍后再试</p>',t.appendChild(i)},Li.query=function(e,t){"use strict";Li.savedQuery.indexOf(e)>-1?(Li.currentWord=Li.savedWords[Li.savedQuery.indexOf(e)],Li.showResult(Li.currentWord,t,!0)):Li.currentWord.word&&e===Li.currentWord.word?Li.showResult(Li.currentWord,t):Li.port.postMessage(e)},Li.listenEnter=function(){"use strict";window.addEventListener("keyup",function(e){if(13===e.keyCode){var t=document.getElementById("searchResult"),n=document.getElementById("search").value.trim();document.getElementById("noteBtn").classList.remove("saved"),t.innerHTMl='<p class="search-item">正在查询，请稍等</p>',n&&!Li.isEmpty(n)&&Li.query(n,t)}})},Li.port.onMessage.addListener(function(e){"use strict";Li.currentWord=e,Li.showResult(Li.currentWord,document.getElementById("searchResult"))}),Li.listenNoteBtnClick=function(){"use strict";var e=document.getElementById("noteBtn");e.addEventListener("click",function(){if(e.classList.contains("saved")){e.classList.remove("saved");var t=Li.savedQuery.indexOf(Li.currentWord);Li.savedQuery.splice(t,1),Li.savedWords.splice(t,1)}else e.classList.add("saved"),Li.savedQuery.push(Li.currentWord.word),Li.savedWords.push(Li.currentWord);var n={};n.words=Li.savedWords,chrome.storage.sync.set(n)})},Li.listenChangeNote=function(){"use strict";var e=document.getElementById("prev"),t=document.getElementById("next");e.addEventListener("click",function(){var e=document.getElementById("current"),t=document.getElementById("total"),n=parseInt(e.innerText),i=parseInt(t.innerText);0!==i&&(1===n?(e.innerText=i,Li.showResult(Li.savedWords[parseInt(e.innerText)-1],document.getElementById("noteResult"))):(e.innerText=n-1,Li.showResult(Li.savedWords[parseInt(e.innerText)-1],document.getElementById("noteResult"))))}),t.addEventListener("click",function(){var e=document.getElementById("current"),t=document.getElementById("total"),n=parseInt(e.innerText),i=parseInt(t.innerText);0!==i&&(n+1>i?(e.innerText=1,Li.showResult(Li.savedWords[0],document.getElementById("noteResult"))):(e.innerText=n+1,Li.showResult(Li.savedWords[parseInt(e.innerText)-1],document.getElementById("noteResult"))))})},Li.listenSettingBtnClick=function(){document.getElementById("settingBtn").addEventListener("click",function(){if(Li.setting.translateSelected)(e={}).setting={translateSelected:!1},chrome.storage.sync.set(e);else{var e={};e.setting={translateSelected:!0},chrome.storage.sync.set(e)}})},Li.listenCopyBtnClick=function(){document.getElementById("copyBtn").addEventListener("click",function(){var e=document.getElementById("LiCopyTransferP"),t=document.getElementById("transferTextarea");e&&t||((e=document.createElement("p")).id="LiCopyTransferP",e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",document.body.appendChild(e),(t=document.createElement("textarea")).id="LiCopyTransferTextarea",t.style.position="fixed",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t)),e.innerHTML="",Li.savedWords.forEach(function(t){t.word&&(e.innerHTML+=t.word+"<br>"),t.pronun&&(e.innerHTML+="发音："+t.pronun+"<br>"),t.means&&t.means.length>0&&t.means.forEach(function(t){e.innerHTML+=t+"<br>"})}),t.value=e.innerText,t.focus(),t.select(),document.execCommand("Copy",!1,null)})},Li.init(),Li.listenChangePage(),Li.listenEnter(),Li.listenNoteBtnClick(),Li.listenChangeNote(),Li.listenSettingBtnClick(),Li.listenCopyBtnClick(),window.addEventListener("beforeunload",function(){if(Li.inited){var e={};e.words=Li.savedWords,chrome.storage.sync.set(e)}}),chrome.storage.onChanged.addListener(function(e){if(!Li.isEmpty(e)&&e.setting){var t=document.getElementById("settingBtn");e.setting.newValue.translateSelected?(t.classList.add("setting-btn-show"),Li.setting.translateSelected=!0):(t.classList.remove("setting-btn-show"),Li.setting.translateSelected=!1)}});