var Li={};!function(){"use strict";var t=new Date,e=t.getUTCFullYear(),o=t.getUTCMonth(),i=t.getUTCDay();Li.notWords=["Li-setting",e+"."+o+"."+i],Li.today=e+"."+o+"."+i}(),Li.init=!0,Li.currentWord={},Li.savedWords=[],Li.savedQuery=[],Li.setting={},Li.isEmpty=function(t){"use strict";for(var e in t)return!1;return!0},Li.init=function(){"use strict";chrome.storage.sync.get("today",function(t){if(t.today!==Li.today){var e={};e.today=Li.today,chrome.storage.sync.set(e),chrome.storage.local.get("words",function(t){t.words;chrome.storage.sync.get("words",function(t){var e=t.words,o=o,i={};if(o){if(e&&length)for(var r=0,n=e.length;r<n;r++)o.concat(e[r]);i.words=o,i.words&&chrome.storage.local.set(i,function(){chrome.storage.sync.set({words:[]})})}})})}else chrome.storage.sync.get("words",function(t){if(t.words&&(Li.savedWords=t.words),Li.savedWords&&Li.savedWords.length)for(var e=0,o=Li.savedWords.length;e<o;e++)Li.savedQuery[e]=Li.savedWords[e].word});chrome.storage.sync.get("setting",function(t){if(t.setting)Li.setting=t.setting;else{var e={};Li.setting={translateSelected:!0},e.setting=Li.setting,chrome.storage.sync.set(e)}}),Li.inited=!0});var t=document.createElement("div"),e=document.createElement("style");e.innerHTML="#Li-root{padding-top:10px!important;z-index:999!important;position:absolute!important;box-shadow:10px 10px 10px rgba(0,0,0,.4)!important;background-color:#fff!important;outline:5px solid #eef5fe!important;color:#444!important;width:250px!important;height:265px!important;float:none!important}#Li-root *{float:none!important;background-color:#fff!important;width:unset!important;height:unset!important}#Li-root .Li-btn-wrapper{width:190px!important;margin:5px 20px!important;padding:0 10px!important}#Li-root .Li-note-btn{background-color:#3fc5c7!important;border:1px solid transparent!important;border-radius:4px!important;font-size:14px!important;padding:3px 6px!important;font-weight:400!important;color:#fff!important;cursor:pointer!important;transition:background-color .3s linear!important}#Li-root .Li-saved{outline:0!important;border-color:#0db3a5!important;position:relative!important;background-color:#1db3a5!important}#Li-root .Li-note-btn:focus{outline:0!important}#Li-root .Li-translation-group-wrapper{width:200px!important;margin:5px auto 10px auto!important;height:220px!important;overflow-y:scroll!important}#Li-root .Li-translation-group-wrapper::-webkit-scrollbar{width:3px!important}#Li-root .Li-translation-group-wrapper::-webkit-scrollbar-track{background-color:#eef5fe!important}#Li-root .Li-translation-group-wrapper::-webkit-scrollbar-thumb{background-color:#2fc5c7!important}#Li-root .Li-translation-group{background-color:#fff!important;border-radius:5px!important;padding:5px!important}#Li-root .Li-translation-group p{margin:5px auto!important;padding:5px!important;border-radius:5px!important;background-color:#eef5fe!important}#Li-root .Li-translation{font-size:12px!important;color:#333!important}#Li-root .Li-search-item{color:#559df3!important;font-size:16px!important}",t.innerHTML='<div class="Li-btn-wrapper"><button class="Li-note-btn" title="做笔记" id="Li-noteBtn" type="button">NOTE</button></div><div class="Li-translation-group-wrapper" id="Li-searchResult"></div>',t.id="Li-root",document.body.appendChild(t),document.head.appendChild(e)},Li.showResult=function(t,e,o){"use strict";e.innerHTML="";var i=document.createElement("div");i.className="Li-translation-group",o&&document.getElementById("Li-noteBtn").classList.add("Li-saved"),t&&!Li.isEmpty(t)?(t.word&&(t.word.length>20?i.innerHTML+='<p class="Li-search-item">'+t.word.slice(0,20)+"...</p>":i.innerHTML+='<p class="Li-search-item">'+t.word+"</p>"),t.pronun&&(i.innerHTML+='<p class="Li-translation">发音：'+t.pronun+"</p>"),t.means&&t.means.length>0?t.means.forEach(function(t){i.innerHTML+='<p class="Li-translation">'+t+"</p>"}):i.innerHTML+='<p class="Li-search-item">很抱歉，没有找到相关的翻译</p>'):i.innerHTML='<p class="Li-search-item">请检查您的网络连接稍后再试</p>',e.appendChild(i)},Li.query=function(t,e){"use strict";Li.savedQuery.indexOf(t)>-1?(Li.currentWord=Li.savedWords[Li.savedQuery.indexOf(t)],Li.showResult(Li.currentWord,e,!0)):Li.currentWord.word&&t===Li.currentWord.word?Li.showResult(Li.currentWord,e):chrome.runtime.sendMessage(t,function(t){Li.currentWord=t,Li.showResult(Li.currentWord,e)})},Li.listenSelect=function(){document.getElementById("Li-root").addEventListener("mouseup",function(t){t.stopPropagation()}),window.addEventListener("mouseup",function(t){var e=(window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()).toString().trim(),o=document.getElementById("Li-root");document.getElementById("Li-searchResult"),document.getElementById("Li-noteBtn");pageX=t.pageX,pageY=t.pageY,o.style.display="none",e&&Li.setting.translateSelected&&(e&&!Li.isEmpty(e)&&Li.query(e,document.getElementById("Li-searchResult")),o.style.display="block",pageX>.6*document.body.offsetWidth?o.style.left=pageX-o.offsetWidth+"px":o.style.left=pageX+"px",top+o.offsetHeight>document.body.offsetHeight?o.style.top=pageY-o.offsetHeight+"px":o.style.top=pageY+"px")})},Li.listenNoteBtnClick=function(){"use strict";var t=document.getElementById("Li-noteBtn");t.addEventListener("click",function(e){if(t.classList.contains("Li-saved")){t.classList.remove("Li-saved");var o=Li.savedQuery.indexOf(Li.currentWord);Li.savedQuery.splice(o,1),Li.savedWords.splice(o,1),(i={}).words=Li.savedWords,chrome.storage.sync.set(i)}else{var i={};i.words=Li.savedWords,t.classList.add("Li-saved"),Li.savedQuery.push(Li.currentWord.word),Li.savedWords.push(Li.currentWord),chrome.storage.sync.set(i)}})},Li.init(),Li.listenNoteBtnClick(),Li.listenSelect(),chrome.storage.onChanged.addListener(function(t){!Li.isEmpty(t)&&t.setting&&(t.setting.newValue.translateSelected?Li.setting.translateSelected=!0:Li.setting.translateSelected=!1)});