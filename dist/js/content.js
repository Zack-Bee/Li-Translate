var Li={};!function(){"use strict";var e=new Date,t=e.getUTCFullYear(),i=e.getUTCMonth(),n=e.getUTCDay();Li.notWords=["Li-setting",t+"."+i+"."+n],Li.today=t+"."+i+"."+n}(),Li.init=!0,Li.currentWord={},Li.savedWords=[],Li.savedQuery=[],Li.setting={},Li.isEmpty=function(e){"use strict";for(var t in e)return!1;return!0},Li.init=function(){"use strict";chrome.storage.sync.get("today",function(e){if(e.today!==Li.today){var t={};t.today=Li.today,chrome.storage.sync.set(t),chrome.storage.local.get("words",function(e){e.words;chrome.storage.sync.get("words",function(e){var t=e.words,i=i,n={};if(i){if(t&&length)for(var s=0,o=t.length;s<o;s++)i.concat(t[s]);n.words=i,n.words&&chrome.storage.local.set(n,function(){chrome.storage.sync.set({words:[]})})}})})}else chrome.storage.sync.get("words",function(e){if(e.words&&(Li.savedWords=e.words),Li.savedWords&&Li.savedWords.length)for(var t=0,i=Li.savedWords.length;t<i;t++)Li.savedQuery[t]=Li.savedWords[t].word});chrome.storage.sync.get("setting",function(e){if(e.setting)Li.setting=e.setting;else{var t={};Li.setting={translateSelected:!0},t.setting=Li.setting,chrome.storage.sync.set(t)}}),Li.inited=!0});var e=document.createElement("div");e.innerHTML='<div class="Li-btn-wrapper"><button class="Li-note-btn" title="做笔记" id="Li-noteBtn" type="button">NOTE</button></div><div class="Li-translation-group-wrapper" id="Li-searchResult"></div>',e.id="Li-root",e.style.paddingTop="10px!important",e.style.zIndex="999!important",e.style.position="absolute!important",e.style.boxShadow="10px 10px 10px rgba(0, 0, 0, 0.4)!important",e.style.backgroundColor="#fff!important",e.style.outline="5px solid #eef5fe!important",e.style.color="#444!important",e.style.width="250px!important",e.style.height="265px!important",e.style.display="none",document.body.appendChild(e)},Li.showResult=function(e,t,i){"use strict";t.innerHTML="";var n=document.createElement("div");n.className="Li-translation-group",i&&document.getElementById("Li-noteBtn").classList.add("Li-saved"),e&&!Li.isEmpty(e)?(e.word&&(e.word.length>20?n.innerHTML+='<p class="Li-search-item">'+e.word.slice(0,20)+"...</p>":n.innerHTML+='<p class="Li-search-item">'+e.word+"</p>"),e.pronun&&(n.innerHTML+='<p class="Li-translation">发音：'+e.pronun+"</p>"),e.means&&e.means.length>0?e.means.forEach(function(e){n.innerHTML+='<p class="Li-translation">'+e+"</p>"}):n.innerHTML+='<p class="Li-search-item">很抱歉，没有找到相关的翻译</p>'):n.innerHTML='<p class="Li-search-item">请检查您的网络连接稍后再试</p>',t.appendChild(n)},Li.query=function(e,t){"use strict";Li.savedQuery.indexOf(e)>-1?(Li.currentWord=Li.savedWords[Li.savedQuery.indexOf(e)],Li.showResult(Li.currentWord,t,!0)):Li.currentWord.word&&e===Li.currentWord.word?Li.showResult(Li.currentWord,t):chrome.runtime.sendMessage(e,function(e){Li.currentWord=e,Li.showResult(Li.currentWord,t)})},Li.listenSelect=function(){document.getElementById("Li-root").addEventListener("mouseup",function(e){e.stopPropagation()}),window.addEventListener("mouseup",function(e){var t=(window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()).toString().trim(),i=document.getElementById("Li-root");document.getElementById("Li-searchResult"),document.getElementById("Li-noteBtn");pageX=e.pageX,pageY=e.pageY,i.style.display="none",t&&Li.setting.translateSelected&&(Li.query(t,document.getElementById("Li-searchResult")),i.style.display="block",pageX>.6*document.body.offsetWidth?i.style.left=pageX-i.offsetWidth+"px":i.style.left=pageX+"px",top+i.offsetHeight>document.body.offsetHeight?i.style.top=pageY-i.offsetHeight+"px":i.style.top=pageY+"px")})},Li.listenNoteBtnClick=function(){"use strict";var e=document.getElementById("Li-noteBtn");e.addEventListener("click",function(t){if(e.classList.contains("Li-saved")){e.classList.remove("Li-saved");var i=Li.savedQuery.indexOf(Li.currentWord);Li.savedQuery.splice(i,1),Li.savedWords.splice(i,1),(n={}).words=Li.savedWords,chrome.storage.sync.set(n)}else{var n={};n.words=Li.savedWords,e.classList.add("Li-saved"),Li.savedQuery.push(Li.currentWord.word),Li.savedWords.push(Li.currentWord),chrome.storage.sync.set(n)}})},Li.init(),Li.listenNoteBtnClick(),Li.listenSelect(),chrome.storage.onChanged.addListener(function(e){!Li.isEmpty(e)&&e.setting&&(e.setting.newValue.translateSelected?Li.setting.translateSelected=!0:Li.setting.translateSelected=!1)});